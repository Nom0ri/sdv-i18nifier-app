import{P as m}from"./PageLayout-24e2585d.js";import{_ as p,r as x,o as T,g as f}from"./404-161bb0bc.js";const $={components:{PageLayout:m},data(){return{inputText:"",contentText:"",i18nText:"",customPrefix:"",separator:"",customImport:""}},computed:{ImportToken(){return this.customImport.length>0?`${this.customImport}`:"ImportToken"}},watch:{inputText:{handler(o){this.processData(o)}},customPrefix:{handler(){this.processData(this.inputText)}},customImport:{handler(){this.processData(this.inputText)}}},methods:{checkInput(o){const e=/\|inputSeparator/g,n=(o.match(e)||[]).length,r=/"(.*?)":/g,t=(o.match(r)||[]).length,c=/\[\#\][^\"]/g,s=(o.match(c)||[]).length;return n>1?(this.contentText="Input only one line of random dialogue.",this.i18nText="",!1):n===1&&t>1?(this.contentText="Don't mix random and regular dialogue.",this.i18nText="",!1):s!==0&&s<t?(this.contentText="Mails are missing titles, add this to the end of the entry: [#]title",this.i18nText="",!1):!0},cutString(o){const e=/\|inputSeparator=(..)/,n=o.match(e),r=/(?:\[\#\])(.*?)(?=\")/g,t=o.match(r);return n?(this.separator=n[1],this.cutStringWithSeparator(o)):t?this.cutMail(o):this.cutStringWithoutSeparator(o)},cutStringWithSeparator(o){const e=/"(.*?)"/g,[,n]=e.exec(o)||[];if(!n)return console.error("Token not found."),{cuts:[],separatorMatch:!0};const r=new RegExp(`(?:Random: ?|${this.separator}|inputSeparator=${this.separator})(.*?)(?=(?:${this.separator}|\\||$))`,"g"),t=[];let c;for(;(c=r.exec(o))!==null;)t.push(c[1]);return{cuts:t.map(i=>{const u=i.split(this.separator).map(a=>a.trim());return{token:n,randomItems:u}}),separatorMatch:!0}},cutStringWithoutSeparator(o){const e=/"((?:\\.|[^"\\])*)"\s*:\s*"((?:\\.|[^"\\])*)"/g,n=[];let r;for(;(r=e.exec(o))!==null;){const[,t,c]=r,s=t.replace(/\\(")/g,'\\"'),i=c.replace(/\\(")/g,'\\"');n.push({token:s,dialogue:i})}return{cuts:n,separatorMatch:!1}},cutMail(o){const e=new RegExp('"(.*?)(?<!\\\\)"\\s*:\\s*"(.*?(?<!\\\\))(?="|%|\\[#]|$)',"g"),n=/(?:\[\#\])(.*?)(?=\")/g,r=[];let t,c={};for(;(t=e.exec(o))!==null;){const s=t[1],i=t[2].trim(),u=n.exec(o);if(u!==null){const a=u[1];c={mailToken:s,mailText:i,mailTitle:a},r.push(c)}}return{cuts:r,mailMatch:!0}},processDataWithoutSeparator(o){let e="",n="";for(const r of o){const{token:t,dialogue:c}=r,s=this.customPrefix?`${this.customPrefix}.`:"",i=this.dynamicTokenCheck(c);e+=`${i?`"${t}": "{{i18n:${s}${t} {{${this.ImportToken}}} }}",
`:`"${t}": "{{i18n:${s}${t}}}",
`}`,n+=`"${s}${t}": "${c}",
`}this.contentText=e,this.i18nText=n},processDataWithSeparator(o){let e="",n="",r={},t="";for(const c of o){const{token:s,randomItems:i,dialogue:u}=c,a=this.customPrefix?`${this.customPrefix}.`:"",h=`${this.dynamicTokenCheck(i)?` {{${this.ImportToken}}} `:""}`;if(i){r[s]||(r[s]=0);const l=r[s]++;t+=`{{i18n:${a}${s}.${l}${h}}} ${this.separator} `,n+=`"${a}${s}.${l}": "${i[0].trim()}",
`}else e+=`"${s}": "{{i18n:${a}${s}}}",
`,n+=`"${a}${s}": "${u}",
`,t&&(e+=`"${s}": "{{Random: ${t}}},
`,t="")}t&&(e+=`"${o[o.length-1].token}": "{{Random: ${t}}},`,e=e.slice(0,-6)+`|inputSeparator=${this.separator}}}",
`),this.contentText=e,this.i18nText=n},processMailData(o){let e=this.inputText,n="";const r=this.customPrefix?`${this.customPrefix}.`:"";for(const t of o){const{mailToken:c,mailTitle:s,mailText:i}=t,a=`${this.dynamicTokenCheck(i)?` {{${this.ImportToken}}} `:""}`;n+=`"${r}${c}.title": "${s}",
`,n+=`"${r}${c}.text": "${i}",
`,e=e.replace(i,`{{i18n:${r}${c}.text${a}}}`),e=e.replace(s,`{{i18n:${r}${c}.title}}`)}this.contentText=e.trim()+`
`,this.i18nText=n.trim()},processData(){const o=this.inputText;if(!this.checkInput(o))return;const{cuts:n,separatorMatch:r,mailMatch:t}=this.cutString(o);r?this.processDataWithSeparator(n):t?this.processMailData(n):this.processDataWithoutSeparator(n)},dynamicTokenCheck(o){const e=/[^"]*({{[^}]*}})[^"]*/g;let n;return(n=e.exec(o))!==null&&n[0].length>4}}};function k(o,e,n,r,t,c){const s=x("PageLayout");return T(),f(s,{title:"Dialogue",showCustomPrefix:"",showCustomImportToken:"",inputText:t.inputText,contentText:t.contentText,i18nText:t.i18nText,customPrefix:t.customPrefix,customImportToken:t.customImport,"onUpdate:inputText":e[0]||(e[0]=i=>t.inputText=i),"onUpdate:customPrefix":e[1]||(e[1]=i=>t.customPrefix=i),"onUpdate:customImportToken":e[2]||(e[2]=i=>t.customImport=i)},null,8,["inputText","contentText","i18nText","customPrefix","customImportToken"])}const P=p($,[["render",k]]);export{P as default};

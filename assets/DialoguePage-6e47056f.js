import{P as x}from"./PageLayout-18b4af50.js";import{c as l}from"./scriptUtils-8ceee955.js";import{_ as T,r as f,o as k,g as $}from"./404-53a01e42.js";const d={components:{PageLayout:x},data(){return{inputText:"",contentText:"",i18nText:"",customPrefix:"",separator:"",customImport:""}},computed:{ImportToken(){return this.customImport.length>0?`${this.customImport}`:"ImportToken"}},watch:{inputText:{handler(o){this.processData(o)}},customPrefix:{handler(){this.processData(this.inputText)}},customImport:{handler(){this.processData(this.inputText)}}},methods:{checkInput(o){const e=/\|inputSeparator/g,n=(o.match(e)||[]).length,s=/"(.*?)":/g,t=(o.match(s)||[]).length,i=/\[\#\][^\"]/g,c=(o.match(i)||[]).length;return n>1?(this.contentText="Input only one line of random dialogue.",this.i18nText="",!1):n===1&&t>1?(this.contentText="Don't mix random and regular dialogue.",this.i18nText="",!1):c!==0&&c<t?(this.contentText="Mails are missing titles, add this to the end of the entry: [#]title",this.i18nText="",!1):!0},cutString(o){const e=/\|inputSeparator=(.*?)\s*}}/i,n=o.match(e),s=/(?:\[\#\])(.*?)(?=\")/g,t=o.match(s);return n?(this.separator=n[1],this.cutStringWithSeparator(o)):t?this.cutMail(o):this.cutStringWithoutSeparator(o)},cutStringWithSeparator(o){const n=o.match(/"(.*?)"/)[1],s=l(n);if(!s)return console.error("Token not found."),{cuts:[],separatorMatch:!0};const t=o.match(/Random:\s?(.*?)(?=\|inputSeparator=)/i),i=t?t[1]:null;return i?{cuts:i.split(this.separator).map(a=>a.trim()).map(a=>({rawToken:n,token:s,randomItems:[a]})),separatorMatch:!0}:{cuts:[],separatorMatch:!0}},cutStringWithoutSeparator(o){const e=/"((?:\\.|[^"\\])*)"\s*:\s*"((?:\\.|[^"\\])*)"/g,n=[];let s;for(;(s=e.exec(o))!==null;){const[,t,i]=s,c=l(t);n.push({rawToken:t,token:c,dialogue:i})}return{cuts:n,separatorMatch:!1}},cutMail(o){const e=new RegExp('"(.*?)(?<!\\\\)"\\s*:\\s*"(.*?(?<!\\\\))(?="|%|\\[#]|$)',"g"),n=/(?:\[\#\])(.*?)(?=\")/g,s=[];let t,i={};for(;(t=e.exec(o))!==null;){const c=l(t[1]),r=t[2].trim(),a=n.exec(o);if(a!==null){const u=a[1];i={mailToken:c,mailText:r,mailTitle:u},s.push(i)}}return{cuts:s,mailMatch:!0}},processDataWithoutSeparator(o){let e="",n="";for(const s of o){const{rawToken:t,token:i,dialogue:c}=s,r=this.customPrefix?`${this.customPrefix}.`:"",u=this.dynamicTokenCheck(c)?` {{${this.ImportToken}}} `:"";e+=`"${t}": "{{i18n:${r}${i}${u}}}",
`,n+=`"${r}${i}": "${c}",
`}this.contentText=e,this.i18nText=n},processDataWithSeparator(o){let e="",n="",s={},t="";for(const i of o){const{rawToken:c,token:r,randomItems:a,dialogue:u}=i,h=this.customPrefix?`${this.customPrefix}.`:"",p=`${this.dynamicTokenCheck(a)?` {{${this.ImportToken}}} `:""}`;if(a&&a.length>0){s[r]||(s[r]=0);const m=s[r]++;t+=`{{i18n:${h}${r}.${m}${p}}} ${this.separator} `,n+=`"${h}${r}.${m}": "${a[0].trim()}",
`}else e+=`"${c}": "{{i18n:${h}${r}}}",
`,n+=`"${h}${r}": "${u}",
`,t&&(e+=`"${c}": "{{Random: ${t}}},
`,t="")}t&&(e+=`"${o[o.length-1].rawToken}": "{{Random: ${t}}},`,e=e.slice(0,-6)+`|inputSeparator=${this.separator}}}",
`),this.contentText=e,this.i18nText=n},processMailData(o){let e=this.inputText,n="";const s=this.customPrefix?`${this.customPrefix}.`:"";for(const t of o){const{mailToken:i,mailTitle:c,mailText:r}=t,u=`${this.dynamicTokenCheck(r)?` {{${this.ImportToken}}} `:""}`;n+=`"${s}${i}.title": "${c}",
`,n+=`"${s}${i}.text": "${r}",
`,e=e.replace(r,`{{i18n:${s}${i}.text${u}}}`),e=e.replace(c,`{{i18n:${s}${i}.title}}`)}this.contentText=e.trim()+`
`,this.i18nText=n.trim()},processData(){const o=this.inputText;if(!this.checkInput(o))return;const{cuts:n,separatorMatch:s,mailMatch:t}=this.cutString(o);s?this.processDataWithSeparator(n):t?this.processMailData(n):this.processDataWithoutSeparator(n)},dynamicTokenCheck(o){const e=/[^"]*({{[^}]*}})[^"]*/g;let n;return(n=e.exec(o))!==null&&n[0].length>4}}};function g(o,e,n,s,t,i){const c=f("PageLayout");return k(),$(c,{title:"Dialogue",showCustomPrefix:"",showCustomImportToken:"",inputText:t.inputText,contentText:t.contentText,i18nText:t.i18nText,customPrefix:t.customPrefix,customImportToken:t.customImport,"onUpdate:inputText":e[0]||(e[0]=r=>t.inputText=r),"onUpdate:customPrefix":e[1]||(e[1]=r=>t.customPrefix=r),"onUpdate:customImportToken":e[2]||(e[2]=r=>t.customImport=r)},null,8,["inputText","contentText","i18nText","customPrefix","customImportToken"])}const R=T(d,[["render",g]]);export{R as default};
